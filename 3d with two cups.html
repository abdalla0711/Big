<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big-PaperCup-3D</title>
    <style>
        /* Basic Reset & Root Variables */
        :root {
            --bg-color: #f5f5f5;
            --text-color: #1a1a1a;
            --accent-color: #007bff;
            --header-bg: rgba(255, 255, 255, 0.8);
            --section-bg: #ffffff;
            --loader-bg: #ffffff;
            --loader-text: #1a1a1a;
            --button-bg: #007bff;
            --button-text: #ffffff;
            --button-hover-bg: #0056b3;
            --border-color: #e0e0e0;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #f5f5f5;
            --accent-color: #00aaff;
            --header-bg: rgba(20, 20, 20, 0.8);
            --section-bg: #1e1e1e;
            --loader-bg: #121212;
            --loader-text: #f5f5f5;
            --button-bg: #00aaff;
            --button-text: #121212;
            --button-hover-bg: #0077cc;
            --border-color: #333333;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        /* Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-color);
            color: var(--button-text);
            padding: 8px;
            z-index: 10000;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Loader */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--loader-bg);
            color: var(--loader-text);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            z-index: 9999;
            transition: opacity 0.5s ease;
            opacity: 1;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Canvas */
        #webgl-canvas {
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
            z-index: -1;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        header .logo {
            font-weight: bold;
            font-size: 1.5rem;
        }

        header nav {
            display: flex;
            align-items: center;
        }

        header nav a {
            color: var(--text-color);
            text-decoration: none;
            margin: 0 1rem;
            transition: color 0.2s;
            font-weight: 500;
        }

        header nav a:hover {
            color: var(--accent-color);
        }

        .header-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .cta-button {
            background-color: var(--button-bg);
            color: var(--button-text);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .cta-button:hover {
            background-color: var(--button-hover-bg);
        }

        .icon-button {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .icon-button:hover {
            background-color: var(--section-bg);
        }

        /* Main Content & Sections */
        main {
            width: 100%;
            position: relative;
            z-index: 1;
        }

        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 5rem 10%;
            max-width: 600px;
            pointer-events: none;
        }
        
        section > * {
            pointer-events: auto;
        }

        section.hero {
            justify-content: center;
            text-align: left;
        }
        
        .content-card {
    background: rgba(255, 255, 255, 0.3); /* 30% opacity */
    border-radius: 12px;
    padding: 2rem;
    margin: 10vh 0;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); /* softer depth */
    backdrop-filter: blur(5px); /* blur effect */
    -webkit-backdrop-filter: blur(12px); /* Safari support */
    border: 1px solid rgba(255, 255, 255, 0.2); /* subtle glass edge */
}


        h1, h2 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 1rem;
            font-weight: 700;
        }

        p {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 500px;
        }

        .learn-more {
            padding: 0.75rem 1.5rem;
        }

        /* Interactive Gallery / Explore Mode UI */
        #explore-ui {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--header-bg);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        #explore-ui.visible {
            opacity: 1;
            visibility: visible;
        }
        
        #explore-ui button {
            font-size: 0.9rem;
        }

        /* RTL support */
        [dir="rtl"] header nav {
            margin-right: auto;
            margin-left: 0;
        }
        [dir="rtl"] section {
            align-items: flex-end;
            margin-left: auto;
            margin-right: 0;
        }
        [dir="rtl"] .content-card, [dir="rtl"] .hero {
             text-align: right;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header nav {
                display: none;
            }
            header {
                padding: 1rem 5%;
            }
            section {
                padding: 4rem 5%;
                margin-left: auto;
                margin-right: auto;
                max-width: 90%;
            }
            .header-buttons {
                gap: 0.5rem;
            }
            .cta-button {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            #explore-ui {
                width: 90%;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link" data-lang-en="Skip to main content" data-lang-ar="ØªØ¬Ø§ÙˆØ² Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Skip to main content</a>

    <div class="loading-overlay">
        <p data-lang-en="Loadingâ€¦ Please wait" data-lang-ar="Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">Loadingâ€¦ Please wait</p>
    </div>
    
    <header>
        <div class="logo">BIG|PaperCups</div>
        <nav>
            <a href="#performance" data-lang-en="Features" data-lang-ar="Ø§Ù„Ù…Ø²Ø§ÙŠØ§">Features</a>
            <a href="#gallery" data-lang-en="Experience" data-lang-ar="Ø¬Ø±Ù‘Ø¨Ù‡Ø§">Experience</a>
            <a href="#cta" data-lang-en="Buy" data-lang-ar="Ø§Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù†">Buy</a>
        </nav>
        <div class="header-buttons">
            <button class="cta-button" id="explore-btn" data-lang-en="Explore in 3D" data-lang-ar="Ø§Ø³ØªÙƒØ´Ù Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯">Explore in 3D</button>
            <button class="cta-button" id="model1-btn" data-lang-en="cup 1" data-lang-ar="Ø§Ù„ÙƒÙˆØ¨ 1">cup 1</button>
            <button class="cta-button" id="model2-btn" data-lang-en="cup 2" data-lang-ar="Ø§Ù„ÙƒÙˆØ¨ 2">cup 2</button>
            <button class="icon-button" id="theme-toggle" aria-label="Toggle dark/light mode">ğŸŒ™</button>
            <button class="icon-button" id="lang-toggle" data-lang-en="AR" data-lang-ar="EN">AR</button>
        </div>
    </header>

    <canvas id="webgl-canvas"></canvas>

    <main id="main-content">
        <section id="hero" class="hero">
            <div class="content-card">

            <h1 data-lang-en="Paper Cup â€“ Professional 3D Showcase" data-lang-ar="ÙƒÙˆØ¨ ÙˆØ±Ù‚ÙŠ â€“ Ø¹Ø±Ø¶ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ø­ØªØ±Ø§ÙÙŠ">Paper Cup â€“ Professional 3D Showcase</h1>
            <p data-lang-en="Discover the perfect blend of design, performance, and sustainability." data-lang-ar="Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ø²ÙŠØ¬ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©."></p>
            <button class="cta-button learn-more" data-lang-en="Learn More" data-lang-ar="Ø§Ø¹Ø±Ù Ø§Ù„Ù…Ø²ÙŠØ¯">Learn More</button>
                  </div>

  </section>

        <section id="performance">
            <div class="content-card">
                <h2 data-lang-en="Lightweight & Heat Resistant" data-lang-ar="Ø®ÙÙŠÙ Ø§Ù„ÙˆØ²Ù† ÙˆÙ…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø­Ø±Ø§Ø±Ø©">Lightweight & Heat Resistant</h2>
                <p data-lang-en="Engineered for comfort and safety, our cups provide excellent insulation, keeping your hands cool and your drinks hot, all in a feather-light design." data-lang-ar="ØµÙÙ…Ù…Øª Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø£Ù…Ø§Ù†ØŒ ØªÙˆÙØ± Ø£ÙƒÙˆØ§Ø¨Ù†Ø§ Ø¹Ø²Ù„Ø§Ù‹ Ù…Ù…ØªØ§Ø²Ù‹Ø§ØŒ Ù…Ù…Ø§ ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¨Ø±ÙˆØ¯Ø© ÙŠØ¯ÙŠÙƒ ÙˆØ³Ø®ÙˆÙ†Ø© Ù…Ø´Ø±ÙˆØ¨Ø§ØªÙƒØŒ ÙƒÙ„ Ø°Ù„Ùƒ ÙÙŠ ØªØµÙ…ÙŠÙ… Ø®ÙÙŠÙ ÙƒØ§Ù„Ø±ÙŠØ´Ø©."></p>
            </div>
        </section>

        <section id="strength">
            <div class="content-card">
                <h2 data-lang-en="Durable & Eco-Friendly" data-lang-ar="Ù…ØªÙŠÙ† ÙˆØµØ¯ÙŠÙ‚ Ù„Ù„Ø¨ÙŠØ¦Ø©">Durable & Eco-Friendly</h2>
                <p data-lang-en="Constructed from multiple layers of sustainably sourced paper, our cups are built to last without leaking, while also being fully recyclable and biodegradable." data-lang-ar="Ù…ØµÙ†ÙˆØ¹Ø© Ù…Ù†  Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…ØŒ ØµÙÙ…Ù…Øª Ø£ÙƒÙˆØ§Ø¨Ù†Ø§ Ù„ØªØ¯ÙˆÙ… Ø¯ÙˆÙ† ØªØ³Ø±ÙŠØ¨ØŒ ÙˆÙ‡ÙŠ Ø£ÙŠØ¶Ù‹Ø§ Ù‚Ø§Ø¨Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ§Ù„ØªØ­Ù„Ù„ Ø§Ù„Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„."></p>
            </div>
        </section>
        
        <section id="detail">
            <div class="content-card">
                <h2 data-lang-en="Precision in Every Detail" data-lang-ar="Ø¯Ù‚Ø© ÙÙŠ ÙƒÙ„ ØªÙØµÙŠÙ„Ø©">Precision in Every Detail</h2>
                <p data-lang-en="From the perfectly rolled rim for a smooth sipping experience to the textured grip, every aspect of our cup is crafted with meticulous attention to detail." data-lang-ar="Ù…Ù† Ø§Ù„Ø­Ø§ÙØ© Ø§Ù„Ù…Ù„ÙÙˆÙØ© Ø¨Ø¥ØªÙ‚Ø§Ù† Ù„ØªØ¬Ø±Ø¨Ø© Ø´Ø±Ø¨ Ø³Ù„Ø³Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù…Ø³ Ø§Ù„Ù…Ø­ÙƒÙ…ØŒ ØªÙ… ØªØµÙ…ÙŠÙ… ÙƒÙ„ Ø¬Ø§Ù†Ø¨ Ù…Ù† Ø¬ÙˆØ§Ù†Ø¨ ÙƒÙˆØ¨Ù†Ø§ Ø¨Ø¹Ù†Ø§ÙŠØ© ÙØ§Ø¦Ù‚Ø© Ù„Ù„ØªÙØ§ØµÙŠÙ„."></p>
            </div>
        </section>

        <section id="gallery">
            <div class="content-card">
                <h2 data-lang-en="Interactive Gallery" data-lang-ar="Ù…Ø¹Ø±Ø¶ ØªÙØ§Ø¹Ù„ÙŠ">Interactive Gallery</h2>
                <p data-lang-en="Explore the different styles and customize the cup to your liking. Click 'Explore in 3D' to start." data-lang-ar="Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ÙˆØ®ØµØµ Ø§Ù„ÙƒÙˆØ¨ Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'Ø§Ø³ØªÙƒØ´Ù Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯' Ù„Ù„Ø¨Ø¯Ø¡."></p>
            </div>
        </section>
        
        <section id="cta">
            <div class="content-card">
                <h2 data-lang-en="Ready to Order?" data-lang-ar="Ù‡Ù„ Ø£Ù†Øª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ù„Ø¨ØŸ">Ready to Order?</h2>
                <p data-lang-en="Get the best paper cups for your business or event. High quality, sustainable, and customizable." data-lang-ar="Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¨ Ø§Ù„ÙˆØ±Ù‚ÙŠØ© Ù„Ø¹Ù…Ù„Ùƒ Ø£Ùˆ Ù…Ù†Ø§Ø³Ø¨ØªÙƒ. Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©ØŒ Ù…Ø³ØªØ¯Ø§Ù…Ø©ØŒ ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ."></p>
                
                <button 
  class="cta-button cta-final" 
  data-lang-en="Buy Now" 
  data-lang-ar="Ø§Ø´ØªØ±ÙŠ Ø§Ù„Ø¢Ù†"
  onclick="window.open('https://wa.me/966538008232?text=' + encodeURIComponent('HI I WANT TO ORDER PAPERCAUPS Ø§Ù‡Ù„Ø§ Ø§Ù†Ø§  Ø§Ø±ÙŠØ¯ Ø´Ø±Ø§Ø¡ Ø§ÙƒÙˆØ§Ø¨ ÙˆØ±Ù‚ÙŠØ©'),'_blank')">
  Buy Now
</button>




            </div>
        </section>
    </main>
    
    <div id="explore-ui">
     <!--button class="cta-button" data-material="white" data-lang-en="White" data-lang-ar="Ø£Ø¨ÙŠØ¶">White</button-->
        <!--button class="cta-button" data-material="kraft" data-lang-en="Kraft" data-lang-ar="ÙˆØ±Ù‚ Ù…Ù‚ÙˆÙ‰">Kraft</button-->
        <!--button class="cta-button" data-material="logo" data-lang-en="Logo Print" data-lang-ar="Ø·Ø¨Ø§Ø¹Ø© Ø´Ø¹Ø§Ø±">Logo Print</button-->
        <button class="cta-button" id="cup-only-btn" data-lang-en="Cup Only" data-lang-ar="Ø§Ù„ÙƒÙˆØ¨ ÙÙ‚Ø·">Cup Only</button>
        <button class="cta-button" id="exit-explore-btn" data-lang-en="Exit" data-lang-ar="Ø®Ø±ÙˆØ¬">Exit</button>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.166.1/build/three.module.js",
            "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.166.1/examples/jsm/",
            "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.5/index.js",
            "gsap/ScrollTrigger": "https://cdn.jsdelivr.net/npm/gsap@3.12.5/ScrollTrigger.js"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
        import gsap from 'gsap';
        import { ScrollTrigger } from 'gsap/ScrollTrigger';

        gsap.registerPlugin(ScrollTrigger);

        /**
         * App State
         */
        const state = {
            isExploreMode: false,
            isTabActive: true,
            prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
        };
        
        /**
         * Language and Theme Management
         */
        const langToggle = document.getElementById('lang-toggle');
        const themeToggle = document.getElementById('theme-toggle');
        let currentLang = 'en';
        function setLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

    document.querySelectorAll('[data-lang-en]').forEach(el => {
        const key = lang === 'ar' ? 'data-lang-ar' : 'data-lang-en';
        if (el.hasAttribute(key)) {
            el.textContent = el.getAttribute(key);
        }
    });

    langToggle.textContent = lang === 'en' ? 'AR' : 'EN';
}

langToggle.addEventListener('click', () => {
    setLanguage(currentLang === 'en' ? 'ar' : 'en');
});

themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    themeToggle.textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
});

// --- ğŸ”¥ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ---
setLanguage('ar'); // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ø±Ø¨ÙŠØ©
document.documentElement.setAttribute('data-theme', 'light'); // Ø§Ù„Ø«ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¯Ø§ÙƒÙ†
themeToggle.textContent = 'â˜€ï¸'; // Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø£Ù† Ø§Ù„Ø²Ø± ÙŠØ­ÙˆÙ„ Ù„Ù„Ù€ light

        /**
         * Three.js Scene Setup
         */
        const canvas = document.getElementById('webgl-canvas');
        const loadingOverlay = document.querySelector('.loading-overlay');
        const scene = new THREE.Scene();
        
        const sizes = {
            width: window.innerWidth,
            height: window.innerHeight,
        };

        const camera = new THREE.PerspectiveCamera(45, sizes.width / sizes.height, 0.01, 100);
        camera.position.set(0, 0, 3);
        scene.add(camera);

        const renderer = new THREE.WebGLRenderer({
            canvas: canvas,
            antialias: true,
            alpha: true,
        });
        
        renderer.setSize(sizes.width, sizes.height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        renderer.physicallyCorrectLights = true;

        /**
         * Lighting
         */
        const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
        scene.add(hemisphereLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 3.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);

        const fillLight = new THREE.DirectionalLight(0xffffff, 1.0);
        fillLight.position.set(-5, 2, 5);
        scene.add(fillLight);
        
        /**
         * Controls
         */
        const controls = new OrbitControls(camera, canvas);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enabled = false;
        controls.minDistance = 0.7;
        controls.maxDistance = 2.2;
        controls.minPolarAngle = THREE.MathUtils.degToRad(20);
        controls.maxPolarAngle = THREE.MathUtils.degToRad(160);
        controls.enablePan = false;
        
        /**
         * Model Loading & Material Handling
         */
        
        const gltfLoader = new GLTFLoader();
        let cupModel = null;
        let swappableMesh = null; // mesh for material swap (first mesh in the model)
        let originalMaterial = null; // original material of swappableMesh
        
        // Two models to switch between
        const modelMap = {
            model1: 'https://files.catbox.moe/9kj0h8.glb',
            model2: 'https://files.catbox.moe/3e8qqd.glb'
        };
        const modelCache = {}; // cache prepared models
        
        function loadAndPrepareModel(url) {
            return new Promise((resolve, reject) => {
                gltfLoader.load(
                    url,
                    (gltf) => {
                        const model = gltf.scene;
                        // Normalize scale & center
                        const box = new THREE.Box3().setFromObject(model);
                        const size = box.getSize(new THREE.Vector3());
                        const center = box.getCenter(new THREE.Vector3());
                        const scale = 1.0 / size.y;
                        model.scale.set(scale, scale, scale);
                        model.position.sub(center.multiplyScalar(scale));
                        
                        // pick first mesh to allow material switching
                        let firstMesh = null;
                        model.traverse((child) => {
                            if (child.isMesh && !firstMesh) {
                                firstMesh = child;
                            }
                        });
                        
                        resolve({
                            model,
                            firstMesh,
                            firstMaterial: firstMesh ? firstMesh.material : null
                        });
                    },
                    undefined,
                    (error) => reject(error)
                );
            });
        }
        
        async function showModel(key) {
            const url = modelMap[key];
            if (!url) return;
            
            // remove current model
            if (cupModel) {
                scene.remove(cupModel);
                cupModel = null;
            }
            
            // load or reuse cached
            if (!modelCache[key]) {
                modelCache[key] = await loadAndPrepareModel(url);
            }
            
            const data = modelCache[key];
            cupModel = data.model;
            swappableMesh = data.firstMesh || null;
            originalMaterial = data.firstMaterial || null;
            
            scene.add(cupModel);
            setupScrollAnimation();
            loadingOverlay.classList.add('hidden');
        }
        
        // Material switching (kept as-is)
        function setMaterial(materialName) {
            if (!swappableMesh) return;

            if (materialName === 'logo') {
                swappableMesh.material = originalMaterial;
            } else if (customMaterials[materialName]) {
                swappableMesh.material = customMaterials[materialName];
            }
        }

        
      /**
 * Scroll Animation
 */
function setupScrollAnimation() {
    if (!cupModel || state.prefersReducedMotion) return;
    // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ ÙˆØ£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ Ù…ÙØ¹Ù„ Ø®ÙŠØ§Ø± ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©

    const tl = gsap.timeline({
        scrollTrigger: {
            trigger: 'main',          // Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù„ÙŠ ÙŠØ±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ…Ø±ÙŠØ±
            start: 'top top',         // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø£ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©
            end: 'bottom bottom',     // ÙŠÙ†ØªÙ‡ÙŠ Ø¹Ù†Ø¯ Ø¢Ø®Ø± Ø§Ù„ØµÙØ­Ø©
            scrub: 1,                 // ÙŠØ±Ø¨Ø· Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±
            invalidateOnRefresh: true // ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„ØµÙØ­Ø©
        },
    });

    const cameraTarget = { x: 0, y: 0, z: 0 };
    // Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² (Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù„ÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¨Øµ Ø¹Ù„ÙŠÙ‡)

    // Ø¨Ø¯Ø§ÙŠØ©: ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    tl.fromTo(camera.position, { y: 0, z: 2.5 }, { y: 5, z: 2.7, ease: 'power1.inOut' }, 0);
    
    // === Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ ===
    // ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙƒÙˆØ¨ Ø¯ÙˆØ±Ø§Ù†Ù‡ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ø«Ù… ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹Ù‡ Ø§Ù„ØªØ§Ù„ÙŠ
    tl.fromTo(cupModel.rotation, { y: -Math.PI * 1 }, { y: Math.PI * 0.8, ease: 'power1.inOut' }, '>');

    // Ù‚ÙØ²Ø© ØµØºÙŠØ±Ø© Ù„Ø£Ø¹Ù„Ù‰ + Ù…ÙŠÙ„ Ø£Ù…Ø§Ù…ÙŠ Ø®ÙÙŠÙ
    tl.to(camera.position, { y: 0.5, ease: 'power1.inOut' }, '<');
    tl.to(cupModel.rotation, { x: -Math.PI * 0.15, ease: 'power2.inOut' }, '>');

    // Ø¯ÙˆØ±Ø§Ù† Ù„Ù„ÙŠÙ…ÙŠÙ† Ù…Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ø¬Ø§Ù†Ø¨
    tl.to(camera.position, { x: 2, z: 2.5, ease: 'power1.inOut' }, '<');
    tl.to(cupModel.rotation, { y: Math.PI * 1.2, ease: 'power1.inOut' }, '>');

    // Ø¯ÙˆØ±Ø§Ù† Ù„Ø£Ø¹Ù„Ù‰ + Ø±ÙØ¹ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    tl.to(camera.position, { y: 1.2, z: 1.8, ease: 'power1.inOut' }, '<');
    tl.to(cupModel.rotation, { x: Math.PI * 0.25, ease: 'power1.inOut' }, '>');

    // Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ø®Ù„Ù + Ù‡Ø¨ÙˆØ· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    tl.to(camera.position, { x: -2, y: 0.2, z: 2.5, ease: 'power1.inOut' }, '<');
    tl.to(cupModel.rotation, { y: Math.PI * 1.8, ease: 'power2.inOut' }, '>');

    // Ù‚ÙØ²Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© ÙŠÙ…ÙŠÙ† + Ø¯ÙˆØ±Ø§Ù† Ø¥Ø¶Ø§ÙÙŠ
    tl.to(camera.position, { x: 3, y: 1, z: 2, ease: 'power1.inOut' }, '<');
    tl.to(cupModel.rotation, { x: -Math.PI * 0.1, y: Math.PI * 0, ease: 'power2.inOut' }, '>');

    // ğŸŒ€ Ø­Ø±ÙƒØ© "Ù„Ù Ø§Ù„Ø²Ø¬Ø§Ø¬Ø©" (Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
    tl.to(cupModel.rotation, {
        z: () => Math.PI * (2 + Math.random() * 1.3), // Ù„ÙØªÙŠÙ† Ø¥Ù„Ù‰ 8 Ù„ÙØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        ease: "power4.out"                          // ØªØ¨Ø¯Ø£ Ø¨Ø³Ø±Ø¹Ø© ÙˆØªÙˆÙ‚Ù ØªØ¯Ø±ÙŠØ¬ÙŠ
    }, '>');

    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù†Ù‚Ø·Ø© Ù‚Ø±ÙŠØ¨Ø© + Ø¯ÙˆØ±Ø§Ù† ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ø±ØªØ¯Ø§Ø¯ (elastic effect)
    tl.to(camera.position, { x: 0, y: 0, z: 2.5, ease: 'power2.inOut' }, '<');
    tl.to(cupModel.rotation, { x: 0, y: Math.PI * 1, z: 0, ease: 'power2.inOut' }, '>');

    // Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ±
    tl.eventCallback('onUpdate', () => {
        camera.lookAt(cameraTarget.x, cameraTarget.y, cameraTarget.z);
    });
}
        
        /**
         * Explore Mode
         */
        const exploreBtn = document.getElementById('explore-btn');
        const exitExploreBtn = document.getElementById('exit-explore-btn');
        const exploreUI = document.getElementById('explore-ui');

        function enterExploreMode() {
            state.isExploreMode = true;
            controls.enabled = true;
            if (!state.prefersReducedMotion) ScrollTrigger.disable();
            document.body.style.overflow = 'hidden';
            exploreUI.classList.add('visible');
            gsap.to(camera.position, { x: 0, y: 0, z: 1.5, duration: 0.8, ease: 'power2.out' });
        }

        function exitExploreMode() {
            state.isExploreMode = false;
            controls.enabled = false;
            if (!state.prefersReducedMotion) ScrollTrigger.enable();
            document.body.style.overflow = '';
            exploreUI.classList.remove('visible');
            if (!state.prefersReducedMotion) ScrollTrigger.refresh();
        }

        exploreBtn.addEventListener('click', enterExploreMode);
        exitExploreBtn.addEventListener('click', exitExploreMode);
        
        exploreUI.addEventListener('click', (e) => {
            if (e.target.matches('[data-material]')) {
                setMaterial(e.target.dataset.material);
            }
        });
        
        document.getElementById('cup-only-btn').addEventListener('click', (e) => {
            const mainEl = document.querySelector('main');
            const headerEl = document.querySelector('header');
            const isHidden = mainEl.style.display === 'none';
            mainEl.style.display = isHidden ? '' : 'none';
            headerEl.style.display = isHidden ? '' : 'none';

            if (currentLang === 'en') {
                e.target.textContent = isHidden ? 'Cup Only' : 'Show UI';
            } else {
                e.target.textContent = isHidden ? 'Ø§Ù„ÙƒÙˆØ¨ ÙÙ‚Ø·' : 'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©';
            }
        });
        
        // --- Model switch buttons in header ---
        const model1Btn = document.getElementById('model1-btn');
        const model2Btn = document.getElementById('model2-btn');
        if (model1Btn && model2Btn) {
            model1Btn.addEventListener('click', () => showModel('model1'));
            model2Btn.addEventListener('click', () => showModel('model2'));
        }
        
        // Load default model at start
        showModel('model1');


        /**
         * Rendering & Animation Loop
         */
        const tick = () => {
            if (state.isTabActive) {
                if (state.isExploreMode) {
                    controls.update();
                }
                renderer.render(scene, camera);
            }
            window.requestAnimationFrame(tick);
        };

        tick();
        
        /**
         * Event Listeners & Handlers
         */
        window.addEventListener('resize', () => {
            sizes.width = window.innerWidth;
            sizes.height = window.innerHeight;

            camera.aspect = sizes.width / sizes.height;
            camera.updateProjectionMatrix();

            renderer.setSize(sizes.width, sizes.height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
            if (!state.prefersReducedMotion) ScrollTrigger.refresh();
        });
        
        document.addEventListener('visibilitychange', () => {
            state.isTabActive = document.visibilityState === 'visible';
        });

    </script>
</body>
</html>